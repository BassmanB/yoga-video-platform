---
/**
 * Auth Error page
 *
 * Displays authentication errors in a user-friendly way
 */

import Layout from "@/layouts/Layout.astro";

// Get error message from query params
const message = Astro.url.searchParams.get("message") || "unknown_error";

// Map error codes to user-friendly messages
const errorMessages: Record<string, { title: string; description: string }> = {
  invalid_token: {
    title: "Nieprawidłowy link",
    description: "Link logowania jest nieprawidłowy lub wygasł. Spróbuj ponownie.",
  },
  invalid_token_type: {
    title: "Nieprawidłowy typ tokenu",
    description: "Ten link nie jest prawidłowym linkiem logowania.",
  },
  no_session: {
    title: "Nie udało się zalogować",
    description: "Nie mogliśmy utworzyć sesji. Spróbuj ponownie.",
  },
  verification_failed: {
    title: "Weryfikacja nie powiodła się",
    description: "Nie udało się zweryfikować linku. Być może wygasł lub został już użyty.",
  },
  expired_token: {
    title: "Link wygasł",
    description: "Ten link logowania już wygasł. Linki są ważne przez 60 minut.",
  },
  unknown_error: {
    title: "Wystąpił błąd",
    description: "Coś poszło nie tak podczas logowania. Spróbuj ponownie.",
  },
};

// Get error details or use default
const errorDetail = errorMessages[message] || errorMessages.unknown_error;

// If message is not a known code, it might be a custom error message from Supabase
const isCustomMessage = !errorMessages[message];
const customMessage = isCustomMessage ? decodeURIComponent(message) : null;
---

<Layout title="Błąd logowania - YogaFit">
  <main class="min-h-screen flex items-center justify-center bg-gradient-yoga p-4">
    <div class="max-w-md w-full space-y-8">
      <!-- Error Icon -->
      <div class="text-center space-y-6">
        <div
          class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-red-50 dark:bg-red-950/20 border-2 border-red-200 dark:border-red-800"
        >
          <span class="text-6xl" aria-hidden="true">⚠️</span>
        </div>

        <div class="space-y-3">
          <h1 class="font-display text-3xl font-bold text-foreground">
            {errorDetail.title}
          </h1>
          <p class="text-lg text-muted-foreground font-body">
            {errorDetail.description}
          </p>

          {
            customMessage && (
              <div class="backdrop-blur-xl bg-card/60 rounded-2xl p-4 border border-border/30">
                <p class="text-sm text-muted-foreground font-mono break-all">{customMessage}</p>
              </div>
            )
          }
        </div>

        <!-- Action buttons -->
        <div class="backdrop-blur-xl bg-card/80 rounded-3xl shadow-float p-8 border border-border/50 space-y-4">
          <a
            href="/auth/login"
            class="block w-full px-6 py-3 bg-primary text-primary-foreground rounded-lg font-semibold hover:bg-primary/90 transition-colors text-center"
          >
            Spróbuj ponownie
          </a>

          <a
            href="/"
            class="block w-full px-6 py-3 bg-secondary text-secondary-foreground rounded-lg font-semibold hover:bg-secondary/90 transition-colors text-center"
          >
            Wróć na stronę główną
          </a>
        </div>

        <!-- Help note -->
        <div class="backdrop-blur-xl bg-card/60 rounded-2xl p-5 border border-border/30">
          <p class="text-xs text-muted-foreground text-center leading-relaxed">
            <strong class="text-foreground">Potrzebujesz pomocy?</strong><br />
            Jeśli problem będzie się powtarzał, skontaktuj się z nami.
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>
